# Bundle Analysis Results - 2025-11-27

## Summary

Split the monolithic vendor chunk into multiple smaller chunks for better caching and initial load performance.

| Metric | Before | After | Change |
|--------|--------|-------|--------|
| Vendor chunk | 416.01 KB | 224.71 KB | -46% |
| Total JS | ~1.9 MB | ~2.1 MB | +10% (more chunks) |

Note: Total JS increased slightly due to chunk overhead, but **initial load is faster** because not all chunks are needed immediately.

## Chunk Breakdown (gzipped)

| Chunk | Size | Notes |
|-------|------|-------|
| vendor | 224.71 KB | Remaining misc dependencies |
| editor | 170.01 KB | BlockNote + ProseMirror + Yjs (lazy loaded) |
| react-vendor | 101.50 KB | Core React (required) |
| index (app) | 98.58 KB | Application code |
| analytics | 53.28 KB | PostHog (deferred) |
| markdown | 53.27 KB | React-markdown + unified ecosystem |
| mantine | 36.38 KB | Mantine UI (for editor) |
| convex | 18.98 KB | Convex client (required) |
| toast | 9.55 KB | Sonner notifications |
| sanitize | 8.75 KB | DOMPurify |
| class-utils | 8.47 KB | clsx, tailwind-merge, cva |
| tour | 6.18 KB | Driver.js onboarding |
| radix-ui | 3.74 KB | Radix primitives |
| icons | 2.90 KB | Lucide icons |

## Changes Made

Updated `vite.config.ts` manual chunks configuration:

```typescript
const chunkMap = [
  // Core React (needed immediately)
  { patterns: ["/react/", "/react-dom/", "/scheduler/"], chunk: "react-vendor" },

  // Convex (needed for data)
  { patterns: ["/convex/", "/@convex-dev/"], chunk: "convex" },

  // UI components (Radix primitives)
  { patterns: ["/@radix-ui/"], chunk: "radix-ui" },

  // Editor (lazy load - only on document pages)
  { patterns: ["/@blocknote/", "/prosemirror", "/yjs/", "/y-prosemirror/", "/lib0/"], chunk: "editor" },
  { patterns: ["/@mantine/"], chunk: "mantine" },

  // Markdown rendering (lazy load)
  { patterns: ["/react-markdown/", "/remark-", "/rehype-", "/unified/", ...], chunk: "markdown" },

  // Icons, search, file utils, email, AI SDK, auth, sanitize, analytics, tour, toast, class-utils
  // ... (see vite.config.ts for full list)
];
```

## Optimization Impact

### Initial Load
- Core bundle (react-vendor + convex + radix-ui + class-utils + toast + icons) = ~145 KB gzipped
- Much better than previous 416 KB vendor chunk

### Lazy Loading
These chunks only load when their features are used:
- `editor` - When opening documents
- `markdown` - When rendering markdown content
- `analytics` - After initial load (deferred)
- `tour` - When starting onboarding
- `sanitize` - When rendering user content

## What's Left in Vendor

The remaining 224 KB vendor chunk contains:
- `@auth/core` and related auth packages
- `@oslojs/crypto` for authentication
- Various utility libraries
- AI SDK core (could be split further if needed)

## Future Optimizations

1. **Dynamic imports** - Use `React.lazy()` for page-level code splitting
2. **Tree shaking** - Audit unused exports from large libraries
3. **AI SDK** - Consider moving to server-side only if not needed in browser
4. **Auth optimization** - Evaluate if all auth code is needed client-side

## Build Output

```
assets/vendor-CWngEDeC.js         850.11 kB │ gzip: 224.71 kB
assets/editor-Bf8Tr3f9.js         571.81 kB │ gzip: 170.01 kB
assets/index-B1Rk2q23.js          473.65 kB │ gzip:  98.58 kB
assets/react-vendor-BrfpaSqN.js   332.48 kB │ gzip: 101.50 kB
assets/markdown-VH6cLL9c.js       181.05 kB │ gzip:  53.27 kB
assets/analytics-zv7Iz6Nw.js      159.97 kB │ gzip:  53.28 kB
assets/mantine-BpmCOo2i.js        125.19 kB │ gzip:  36.38 kB
assets/convex-D0DKXBMO.js          66.04 kB │ gzip:  18.98 kB
assets/toast-BnlFefSq.js           33.43 kB │ gzip:   9.55 kB
assets/class-utils-Dr6D9L7d.js     26.13 kB │ gzip:   8.47 kB
assets/sanitize-umG2IIds.js        22.61 kB │ gzip:   8.75 kB
assets/tour-BlmajLkN.js            20.92 kB │ gzip:   6.18 kB
assets/radix-ui-D7UIKlFq.js        11.26 kB │ gzip:   3.74 kB
assets/icons-CEdcLtEW.js            6.94 kB │ gzip:   2.90 kB
```

---

*Last Updated: 2025-11-27*
