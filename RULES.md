# RULES.md - Development Rules & Conventions

> **Last Updated:** 2026-01-19

Generic development rules and conventions for AI assistants. Project-specific details are in CLAUDE.md.

## HARD RULES (NO EXCEPTIONS)

- **NEVER** add "Co-Authored-By", "Generated by", or any AI attribution to commits
- **NEVER** use `>/dev/null`, `2>/dev/null`, `2>nul`, or any null redirect (creates junk `nul` files on Windows)
- **NEVER** commit secrets or credentials
- **NEVER** update the git config

---

## TypeScript Rules

### Strict Type Safety

- Use strict type checking (enabled in tsconfig)
- Prefer explicit types for function parameters
- Use generated types from framework (Convex, Prisma, etc.)

### Forbidden Patterns

```typescript
// ❌ FORBIDDEN - any type
function process(data: any) {}

// ✅ CORRECT - specific types or unknown with guards
function process(data: unknown) {
  if (typeof data === 'object' && data !== null && 'id' in data) {
    // Type guard ensures safety
  }
}
```

```typescript
// ❌ FORBIDDEN - type assertions for convenience
const user = req.body as User;

// ✅ CORRECT - type guards
function isUser(obj: unknown): obj is User {
  return typeof obj === 'object' && obj !== null && 'id' in obj;
}
if (isUser(body)) {
  const user: User = body;
}
```

### Required Practices

1. **Explicit return types** for functions
2. **Proper error handling** with typed catches
3. **No `@ts-ignore` or `@ts-nocheck`** - fix the actual issues
4. **No `biome-ignore`** unless absolutely necessary with justification

---

## Code Style

### Naming Conventions

| Element | Convention | Example |
|---------|------------|---------|
| Components | PascalCase | `DocumentEditor.tsx` |
| Utilities | camelCase | `formatDate.ts` |
| Constants | UPPER_SNAKE_CASE | `API_ENDPOINTS` |
| Functions | camelCase | `createDocument()` |
| Types/Interfaces | PascalCase | `interface UserProfile` |

### Import Organization

Imports should be sorted in this order:
1. Node.js built-ins (`node:fs`, `path`)
2. External packages (`react`, `lodash`)
3. Internal packages (`@/components`, `@repo/ui`)
4. Parent imports (`../utils`)
5. Sibling imports (`./helper`)
6. Style imports (`*.css`)

### Export Patterns

```typescript
// ✅ CORRECT - Named exports for components
export function ComponentName(props: Props) {
  return <div>...</div>;
}

// ❌ INCORRECT - Default exports
export default function ComponentName() {}
```

---

## Git & Version Control

- **NEVER** commit unless explicitly asked
- **NEVER** push to remote unless explicitly asked
- **NEVER** use git commands with `-i` flag (interactive mode not supported)
- **NEVER** use `--amend` unless explicitly asked
- If no changes to commit, do not create an empty commit
- Use descriptive commit messages focusing on "why" not "what"

---

## File Management

- **NEVER** create files unless absolutely necessary
- **ALWAYS** prefer editing existing files over creating new ones
- **NEVER** proactively create documentation files (*.md, README) unless asked
- Avoid deleting node_modules directories without reason

---

## Testing Rules

### General Approach

- Write tests alongside code (`.spec.ts` or `.test.ts` files)
- **NEVER** assume specific test framework - check package.json first
- Run tests before committing significant changes

### Playwright/E2E Testing

```typescript
// ✅ CORRECT - Accessible selectors
await page.getByRole('button', { name: /submit/i });
await page.getByLabel('Email');
await page.getByTestId('complex-widget'); // Last resort

// ❌ WRONG - Raw selectors
await page.waitForSelector('[data-testid="..."]');
await page.waitForLoadState('networkidle');
```

---

## Package Manager

- Use **pnpm** for all package management (unless project specifies otherwise)
- Use `pnpm` instead of `npm`
- **NEVER** use `npx` directly - stdout is swallowed in nvm4w + Git Bash
- **NOTE**: `pnpm run` also swallows stdout in Claude Code's Git Bash environment
- For typecheck/biome, use direct node commands: `node node_modules/<pkg>/bin/<cli>`
- Always check package.json for available scripts before guessing

---

## Code Quality

### Before Writing Code

1. **Read the file first** - never propose changes to code you haven't read
2. **Match existing patterns** in the file you're editing
3. **Check surrounding context** especially imports
4. **Verify library usage** in existing codebase

### After Making Changes

1. Run linting: `pnpm lint` or `pnpm biome`
2. Run type checking: `pnpm typecheck`
3. Run tests if applicable
4. If unable to find correct command, ask

### Avoid Over-Engineering

- Only make changes that are directly requested or clearly necessary
- Don't add features, refactor code, or make "improvements" beyond what was asked
- Don't add docstrings, comments, or type annotations to code you didn't change
- Don't add error handling for scenarios that can't happen
- Don't create helpers or abstractions for one-time operations

---

## Security

- **ALWAYS** validate user input at system boundaries
- **NEVER** expose or log secrets and keys
- Check authentication in every mutation/query
- Throw errors for unauthorized access
- Use framework validators for runtime type safety

---

## Communication

- Focus on specific requests
- Provide honest technical feedback
- Challenge questionable approaches and suggest better alternatives
- Don't use excessive praise or validation
